---
layout: post
title: 类数组转换为数组
subtitle: 类数组、Array.from()、类数组使用数组的方法
date: 2019-03-16
author: Myw
header-img: img/post-normal-bg.jpg
catalog: true
tags:
    - JavaScript
    - JS Array API
    - Interview
---

## 从面试题入手

通常我们写类数组对象时，会从数组的原型上借调一些方法；这些方法通常会保留其原来的一些特性。

```js
let obj = {
  0: 'a',
  2: 'b',
  4: 'c',
  length: 3,
  push: Array.prototype.push
}
obj.push('d');
obj.push('e');
console.info(obj);
/**
* Output -->
* {
*    '0': 'a',
*    '2': 'b',
*    '3': 'd',
*    '0': 'a',
*    length: 5,
*    push: [Function: push]
* }
*/
```

obj 对象中的 push 方法是从数组的原型上借调过来的方法，数组的`push()`方法是从 length 属性入手，从 length + 1 处开始添加元素。

所以上面代码中 push 的 d 和 e 会占位的 index 是 3 和 4，从而改变 length 属性。

当我们去掉 length 属性之后，输出如下：

```js
/**
* Output -->
* {
*    '0': 'd',
*    '1': 'e',
*    '2': 'b',
*    '4': 'c',
*    push: [Function: push]
* }
*/
```

也就是说，当没有 length 属性，push 方法会默认操作的类数组是空的，默认从 index 为 0 的位置开始添加元素。此时打印出的这个类数组的 length 为 2。

## 类数组的介绍、转换为数组的方法

>MDN：拥有 length 属性和若干索引的对象。

在开发过程中，经常获取一些 DOM 相关的集合，这类集合也被称为类数组；但是却不能使用数组的 API 来操作这类集合，于是出现了以下转换操作：

```js
let nodelist = document.querySelectorAll('div');
// 方法一。
let nodelistToArray = Array.apply(null, nodelist);
let nodelistToArray = Array.prototype.concat.apply([], nodelist);
// 方法二。
let nodelistToArray = Array.prototype.slice.call(nodelist);
// 方法三。
let nodelistToArray = Array.prototype.splice.call(nodelist, 0);
// 方法四。
let nodelistToArray = [...nodelist];
// 方法五。
let nodelistToArray = Array.from(nodelist);
```

## 拓展延伸

### Array.from()

在了解这个 API 之前，我们先看看可迭代对象的定义：

>MDN：可以获取对象中的元素，如 Map、Set。

再看这个 API 的定义：

从一个类数组或一个可迭代对象中创建一个新的**浅拷贝**实例。

接收三个参数：

1. 想要转换成数组的类数组或可迭代对象。
2. 回调函数（可选），如果指定，新数组中每个元素都会执行该回调函数，这个回调函数的作用类似于`map()`方法。
3. 执行回调函数时绑定的 this（可选）。

返回值：一个新的深拷贝数组。

PS. **`Array.from(obj, mapFn, thisArg)` 的作用就等同于 `Array.from(obj).map(mapFn, thisArg)` 。**

```js
Array.from([1, 2, 3], x => x + x); // Output --> [2, 4, 6]
```

当然只要是可迭代对象，都可以使用这个方法来生成数组，包括`String、Set、Map、函数参数arguments`等。

下面看一个具体的例子，加深对这个 API 的理解：

```js
function combine() {
  let arr = [].concat.apply([], arguments);
  return Array.from(new Set(arr));
}
let m = [1, 2, 2], n = [2, 3, 3];
console.log(combine(m, n)); // Output --> [1, 2, 3]
```

上面的例子使用`apply()`方法传入空数组作为 this 值，combine() 函数的参数作为第二个参数，整个集合与一个空数组作拼接，再使用`set()`方法的元素不重复特性来去重。

## 参考链接

- [MDN -> Array.from](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/from)
